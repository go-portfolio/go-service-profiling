# Go Profiling Service üöÄ

–°–µ—Ä–≤–∏—Å –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏—è CPU, –ø–∞–º—è—Ç–∏ –∏ –∑–∞–¥–µ—Ä–∂–µ–∫ –≤ Go, —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π –º–µ—Ç—Ä–∏–∫ Prometheus –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π Docker.

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π

```bash
git clone <your-repo-url>
cd go-service-profiling
```
2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
```bash
go mod tidy
```
3. –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞
```bash
make run
```
–°–µ—Ä–≤–∏—Å –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ http://localhost:8080

## ‚öôÔ∏è –î–æ—Å—Ç—É–ø–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
| URL             | –û–ø–∏—Å–∞–Ω–∏–µ                                                |
| --------------- | ------------------------------------------------------- |
| `/`             | –ö–æ—Ä–Ω–µ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞, —Å–æ–æ–±—â–∞–µ—Ç —á—Ç–æ —Å–µ—Ä–≤–∏—Å –∑–∞–ø—É—â–µ–Ω          |
| `/work`         | –ò–º–∏—Ç–∏—Ä—É–µ—Ç –Ω–∞–≥—Ä—É–∑–∫—É CPU                                  |
| `/alloc`        | –ò–º–∏—Ç–∏—Ä—É–µ—Ç –≤—ã–¥–µ–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏ –∏ —Å–±–æ—Ä–∫—É –º—É—Å–æ—Ä–∞              |
| `/sleep`        | –ò–º–∏—Ç–∏—Ä—É–µ—Ç –∑–∞–¥–µ—Ä–∂–∫—É (sleep)                              |
| `/metrics`      | –≠–∫—Å–ø–æ—Ä—Ç –º–µ—Ç—Ä–∏–∫ Prometheus                               |
| `/debug/pprof/` | –ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ pprof (CPU, heap, goroutine –∏ –¥—Ä.) |


## üìä –ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ
CPU –ø—Ä–æ—Ñ–∞–π–ª
```bash
./scripts/profile-cpu.sh
# –°–æ—Ö—Ä–∞–Ω–∏—Ç—Å—è cpu.prof
# –î–∞–ª–µ–µ –æ—Ç–∫—Ä–æ–µ–º –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å:
go tool pprof -http=:8081 ./bin/service cpu.prof
```
Heap –ø—Ä–æ—Ñ–∞–π–ª (–ø–∞–º—è—Ç—å)
```bash
./scripts/profile-heap.sh
# –°–æ—Ö—Ä–∞–Ω–∏—Ç—Å—è heap.prof
# –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å:
go tool pprof -http=:8081 ./bin/service heap.prof
```
–í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å pprof –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ –∏–∑—É—á–∞—Ç—å, –∫–∞–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ—Ç—Ä–µ–±–ª—è—é—Ç CPU –∏ –ø–∞–º—è—Ç—å.

##  –ë–µ–Ω—á–º–∞—Ä–∫–∏
–ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö –±–µ–Ω—á–º–∞—Ä–∫–æ–≤ —Å –∏–∑–º–µ—Ä–µ–Ω–∏–µ–º –ø–∞–º—è—Ç–∏:

bash
```
make bench
```
-bench=. ‚Äî –∑–∞–ø—É—Å–∫ –≤—Å–µ—Ö –±–µ–Ω—á–º–∞—Ä–∫–æ–≤

-benchmem ‚Äî –∏–∑–º–µ—Ä–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–∞–º—è—Ç–∏

## üê≥ Docker
–°–±–æ—Ä–∫–∞ Docker-–æ–±—Ä–∞–∑–∞:

```bash
make docker-build
```
–ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:

```bash
docker run -p 8080:8080 go-service-profiling:latest
```
## üìà –ú–µ—Ç—Ä–∏–∫–∏ Prometheus
–°–µ—Ä–≤–∏—Å —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ –Ω–∞ /metrics.
–ü—Ä–∏–º–µ—Ä –º–µ—Ç—Ä–∏–∫–∏:

```nginx
http_requests_total 42
```
`http_requests_total` ‚Äî –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ HTTP-–∑–∞–ø—Ä–æ—Å–æ–≤ –∫ —Å–µ—Ä–≤–∏—Å—É


## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
```bash
go-service-profiling/
‚îú‚îÄ‚îÄ cmd/server/          # main.go ‚Äî —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îú‚îÄ‚îÄ internal/
‚îÇ   ‚îú‚îÄ‚îÄ handlers/        # HTTP-—Ö–µ–Ω–¥–ª–µ—Ä—ã
‚îÇ   ‚îú‚îÄ‚îÄ metrics/         # –º–µ—Ç—Ä–∏–∫–∏ Prometheus
‚îÇ   ‚îî‚îÄ‚îÄ workload/        # —Ñ—É–Ω–∫—Ü–∏–∏ –∏–º–∏—Ç–∞—Ü–∏–∏ –Ω–∞–≥—Ä—É–∑–∫–∏ (CPU, memory, sleep)
‚îú‚îÄ‚îÄ tests/               # —Ç–µ—Å—Ç—ã –∏ –±–µ–Ω—á–º–∞—Ä–∫–∏
‚îú‚îÄ‚îÄ scripts/             # —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏—è (CPU, heap –∏ –¥—Ä.)
‚îú‚îÄ‚îÄ bin/                 # —Å–æ–±—Ä–∞–Ω–Ω—ã–π –±–∏–Ω–∞—Ä–Ω–∏–∫
‚îú‚îÄ‚îÄ Makefile             # —Å–±–æ—Ä–∫–∞, –∑–∞–ø—É—Å–∫, –±–µ–Ω—á–º–∞—Ä–∫–∏, Docker
‚îî‚îÄ‚îÄ README.md
```
üí° –°–æ–≤–µ—Ç—ã
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `/work`, `/alloc` –∏ `/sleep` –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –Ω–∞–≥—Ä—É–∑–∫–∏ –ø–µ—Ä–µ–¥ –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ–º.
- –û—Ç–∫—Ä—ã–≤–∞–π—Ç–µ –ø—Ä–æ—Ñ–∏–ª–∏ —á–µ—Ä–µ–∑ `go tool pprof -http=:8081`, —á—Ç–æ–±—ã –≤–∏–¥–µ—Ç—å –≥—Ä–∞—Ñ–∏–∫–∏ –∏ –≥–æ—Ä—è—á–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏.
- –ú–µ—Ç—Ä–∏–∫–∏ `Prometheus` –º–æ–∂–Ω–æ –ø–æ–¥–∫–ª—é—á–∞—Ç—å –∫ `Grafana` –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏.
